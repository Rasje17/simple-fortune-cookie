name: Fortune Cookie
on:
  push:
    branches:
      - "develop"
      - "feature/**"
env:
  docker_username: ${{ secrets.DOCKER_USER }}
  docker_password: ${{ secrets.DOCKER_PW }}
  GIT_COMMIT: ${{ github.sha }}
jobs:
  Clone-down:
    name: Clone down repo
    runs-on: [self-hosted, label-1]
    #container: gradle:6-jdk11
    steps:
    - uses: actions/checkout@v2
    - name: Upload Repo
      uses: actions/upload-artifact@v2
      with:
        name: code
        path: |
          .
          !.git
  # Build:
  #   runs-on: [self-hosted, label-1]
  #   needs: Clone-down
  #   #container: gradle:6-jdk11
  #   steps:
  #     - name: Download code
  #       uses: actions/download-artifact@v2
  #       with:
  #         name: code
  #         path: .
  #     # - name: Build backend
  #     #   run: source ~/.profile && go build ./backend/
  #     #- name: Test
  #     #  run: chmod +x ci/unit-test-app.sh && ci/unit-test-app.sh
  #     # - name: Upload Repo
  #     #   uses: actions/upload-artifact@v2
  #     #   with: 
  #     #     name: code
  #     #     path: .
  #     #- name: Upload_binary
  #     #  uses: actions/upload-artifact@v2
  #     #  with:
  #     #    name: build
  #     #    path: app/build/libs/app-0.1-all.jar
  Docker-image:
    runs-on: [self-hosted, label-1]
    steps:
      - name: Download code
        uses: actions/download-artifact@v2
        with:
          name: code
          path: .
      - name: build backend
        run: chmod +x ci/build-docker-backend.sh && ci/build-docker-backend.sh
      - name: build frontend
        run: chmod +x ci/build-docker-frontend.sh && ci/build-docker-frontend.sh 
  #Component-test:
  #  runs-on: [self-hosted, label-1]
  #  needs: Docker-image
  #  steps:
  #    - name: Download code
  #      uses: actions/download-artifact@v2
  #      with:
  #        name: code
  #        path: .
  #    - name: Execute component test
  #      run: chmod +x ci/component-test.sh && GIT_COMMIT="GA-$GITHUB_SHA" && ci/component-test.sh
  #Preformance-test:
  #  runs-on: [self-hosted, label-1]
  #  needs: Docker-image
  #  steps:
  #    - name: Download code
  #      uses: actions/download-artifact@v2
  #      with:
  #        name: code
  #        path: .
  #    - name: Execute preformance teset 
  #      run: chmod +x ci/performance-test.sh && ci/performance-test.sh
  #